<!DOCTYPE html>
<html>
<head>
   <meta http-equiv="content-type" content="text/html;charset=utf-8"> 
   <title>Building Web Services (HTTP APIs) with Go</title>

<meta name="generator" content="Slide Show (S9) 2.3.0 on Ruby 2.1.4 (2014-10-27) [i686-linux]">
<meta name="author"    content="Your Name Here" >

<!-- helper/macro that lets you add (CSS3) gradient using headers
     see http://slideshow.rubyforge.org/themes.html
     
     -->

<!-- S6 style sheet links -->
<link rel="stylesheet" href="go_http_api.css" media="projection" id="styleProjection">
<link rel="stylesheet" href="s6/screen.css"         media="screen"     id="styleScreen">
<link rel="stylesheet" href="s6/print.css"          media="print">

<!-- S6 JS -->
<script src="s6/jquery.js"></script>
<script src="s6/jquery.slideshow.js"></script>
<script>
  $(document).ready( function() {
    Slideshow.init();
  } );

  
</script>

<!-- Better Browser Banner for Microsoft Internet Explorer (IE) -->
<!--[if IE]>
<script src="s6/jquery.microsoft.js"></script>
<![endif]-->



</head>
<body>

<div class="layout"> 
  <div id="header"></div>
  <div id="footer">
    <h1>Your Footer Here</h1>
    <h2>Your Subfooter Here</h2>
  </div>
</div>

<div class="presentation">
   
<div class='slide '>
<!-- === begin markdown block ===

      generated by markdown 1.1.1 on Ruby 2.1.4 (2014-10-27) [i686-linux]
                on 2014-11-20 11:16:48 +0100 with Markdown engine redcarpet (3.2.0) w/ HTML render
                  using extensions: ["no_intra_emphasis","fenced_code_blocks","tables","strikethrough"]
  -->

<!-- _S9SLIDE_ -->
<h1>What&#39;s football.db? What&#39;s sportkit?</h1>

<p>Free open public domain football datasets (leagues, teams, matches, etc.) -&gt; <a href="https://github.com/openfootball"><code>github.com/openfootball</code></a></p>

<pre><code>Quarter-finals - 1st Leg

[Tue Apr/1]
  20.45   FC Barcelona        1-1  Atlético Madrid     @ Camp Nou, Barcelona
            [Neymar 71&#39;; Diego 56&#39;]
  20.45   Manchester United   1-1  Bayern München      @ Old Trafford, Manchester
            [Vidić 58&#39;; Schweinsteiger 67&#39;]
[Wed Apr/2]
  20.45   Real Madrid         3-0  Borussia Dortmund   @ Santiago Bernabéu, Madrid
            [Bale 3&#39; Isco 27&#39; Ronaldo 57&#39;]
  20.45   Paris Saint-Germain 3-1  Chelsea FC          @ Parc des Princes, Paris
            [Lavezzi 4&#39; Luiz 61&#39; (o.g.) Pastore 90+3&#39;; Hazard 27&#39; (pen.)]
</code></pre>

<p>or in JSON via HTTP <code>GET /events</code></p>

<pre><code>[
  {&quot;key&quot;:&quot;en.2014/15&quot;,&quot;title&quot;:&quot;English Premier League 2014/15&quot;},
  {&quot;key&quot;:&quot;de.2014/15&quot;,&quot;title&quot;:&quot;Deutsche Bundesliga 2014/15&quot;},
  {&quot;key&quot;:&quot;at.2014/15&quot;,&quot;title&quot;:&quot;Österr. Bundesliga 2014/15&quot;},
  ...
]
</code></pre>

<p>Includes sportkit - starter kit for HTTP JSON API - Go Edition -&gt; <a href="https://github.com/sportkit"><code>github.com/sportkit</code></a></p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Go Structs, Structs, Structs</h1>

<p><code>sportkit/database_structs.go</code>:</p>

<pre><code>type Event struct {
  Key   string
  Title string
}
type Team struct {
  Key   string
  Title string
  Code  string
}
</code></pre>

<p>NOTE: Go ids (names) starting with capital letter (upper case) are public (by definition).</p>

<pre><code>type JsEvent struct {
  Key   string `json:&quot;key&quot;`
  Title string `json:&quot;title&quot;`
}

type JsTeam struct {
  Key   string `json:&quot;key&quot;`
  Title string `json:&quot;title&quot;`
  Code  string `json:&quot;code&quot;`
}
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Database Queries</h1>

<p><code>sportkit/database_finders.go</code>:</p>

<pre><code>query :=
 `SELECT
    e.[key] AS event_key,
    l.title || &#39; &#39; || s.title AS event_name
  FROM events e
   INNER JOIN seasons s ON s.id = e.season_id
   INNER JOIN leagues l ON l.id = e.league_id`
</code></pre>

<p>NOTE: Go &quot;raw&quot; strings with backquotes (`) let you use multi-line string literals.</p>

<pre><code>import (
  &quot;database/sql&quot;
  _ &quot;github.com/mattn/go-sqlite3&quot;
  &quot;log&quot;
)
</code></pre>

<p>NOTE: You can use Go packages &quot;hosted&quot; on Github. Works &quot;out-of-the-box&quot;.
Use <code>go get github.com/mattn/go-sqlite3</code> to install.</p>

<pre><code>func FetchEvents() []Event {

  db = sql.Open( &quot;sqlite3&quot;, &quot;./football.db&quot; )
  if err != nil {
    log.Fatal(err)
  }

  rows, err := db.Query( query )
  if err != nil {
    log.Fatal(err)
  }
  defer rows.Close()

  events := []Event{}

  for rows.Next() {
    var r Event
    err = rows.Scan( &amp;r.Key, &amp;r.Title )
    if err != nil {
      log.Fatal(err)
    }
    events = append( events, r ) // add new row
  }
  return events
}
</code></pre>

<p>NOTE: Go has NO exceptions; function (almost) always returns error (<code>err</code>) types.</p>

<p>Why no exceptions?  Go&#39;s headline feature is concurrency (w/ Go (co)routines and channels) -
exceptions do NOT really work in an (asynchronous) concurrent world.</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Generate (Encode) JSON</h1>

<pre><code>import (
  &quot;encoding/json&quot;
)
</code></pre>

<pre><code>func GetEvents() (interface{},error) {
  // step 1: fetch records
  events := FetchEvents()
  log.Println( events )

  // step 2: map to json structs for serialization/marshalling
  type JsEvent struct {
    Key   string `json:&quot;key&quot;`
    Title string `json:&quot;title&quot;`
  }
  data := []*JsEvent{}

  for _,event := range events {
    data = append( data, &amp;JsEvent {
                            Key:   event.Key,
                            Title: event.Title, } )
  }

  return json.Marshal( data )
}
</code></pre>

<p>NOTE: <code>interface{}</code> is the Go version of the any object type (<code>void*</code>).</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Serve via HTTP</h1>

<pre><code>import (
  &quot;net/http&quot;
  &quot;net/url&quot;
  &quot;fmt&quot;
  &quot;strings&quot;
)
</code></pre>

<pre><code>func main() {
  addr := &quot;:9292&quot; 
  fmt.Println( &quot;Starting web server listening on &quot; + addr + &quot;...&quot; )
  fmt.Println( &quot;Use Ctrl-C to stop&quot; )

  http.HandleFunc( &quot;/&quot;, handleFunc )
  http.ListenAndServe( addr, nil )
  fmt.Println( &quot;Bye&quot; )
}
</code></pre>

<pre><code>func handleFunc( w http.ResponseWriter, r *http.Request ) {
  log.Println( &quot;handle url.path: &quot; + r.URL.Path )

  eventsRoute, _ := regexp.Compile( &quot;^/events$&quot; )

  if eventsRoute.MatchString( r.URL.Path ) {
    b, err := GetEvents()
    if err != nil {
      fmt.Fprintf( w, err.Error() )
    }
    else {
      fmt.Fprintf( w, string(b) )
    }
  }
  else {
    fmt.Fprintf( w, &quot;No route match found for &quot; + r.URL.Path )
  }
}
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Why Go? - Faster, Faster, Faster</h1>

<p>Use what works for you.</p>

<p>Kind of a &quot;better&quot; more &quot;modern&quot; C.</p>

<p>Code gets compiled (to machine-code ahead-of-time) and linked
to let you build (small-ish) zero-dependency
all-in-one binary (file) programs.</p>

<p>No virtual machine or byte code runtime or just-in-time compiler machinery needed;
includes garbage collector.</p>

<h2>Go&#39;s Headline Features</h2>

<ul>
<li>Fast Builds - Imports, Package Structure, etc.</li>
<li>Concurreny - Go (co)-routines, channels
e.g. &quot;agent model&quot; - no threads, no shared state/variables - message passing w/ agents, etc.</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>That&#39;s it. Thanks.</h1>

<h3>Questions? Comments?</h3>

<h3>Go Links</h3>

<ul>
<li><a href="http://go-database-sql.org">Go SQL Tutorial (Series)</a></li>
<li><a href="https://github.com/jmoiron/sqlx">sqlx package</a> - general extensions to database/sql e.g. includes <code>rows.StructScan()</code></li>
<li><a href="https://howistart.org/posts/go/1">How I start (Go Edition</a> - builds a small HTTP JSON API wrapper/proxy for weather service</li>
<li><a href="http://learnxinyminutes.com/docs/go">Learn Go in 5 Minutes</a> - single-page &quot;cheatsheet&quot; - &quot;real-world&quot; code w/ comments</li>
</ul>

<h3>Free Online Go Books</h3>

<ul>
<li><a href="http://www.golangbootcamp.com/book">The Go Bootcamp Book</a> by Matt Aimonetti</li>
<li><a href="http://www.golang-book.com">An Introduction to Programming in Go</a> by Caleb Doxsey</li>
</ul>
<!-- === end markdown block === -->
</div>


</div><!-- presentation -->
</body>
</html>