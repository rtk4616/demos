<!DOCTYPE html>
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Building Static (Web) Sites w/ Metalsmith (Node.js)</title>
   
   

<style>
html, body { margin: 0; padding: 0; }

body { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; }

a:link, a:visited { color: black; }

h1 { font-size: 30pt;  }
h2 { font-size: 28pt;  }
h3 { font-size: 25pt;  }
p, li, dt, dd, td, th { font-size: 18pt; }

pre { font-size: 14pt;  }
pre.small { font-size: 11pt; }

pre.code {
        background-color: azure;
        padding: 5px;
      }
     
ul { list-style-type: square; }    
   
.center { text-align: center; }   
     
.slide { page-break-after: always;
         min-height: 100mm;
         padding: 40px;
         
         border: 1px dotted black;

/*      
  background: -moz-linear-gradient( top, maroon, red);
*/
       }



/*
for princexml (CSS3 paged media support)
@page { size: A4 landscape }
*/
</style>

</head>
<body>

<div class="presentation">

<div class='slide '>
<!-- === begin markdown block ===

      generated by markdown/1.2.0 on Ruby 2.1.5 (2014-11-13) [i386-mingw32]
                on 2016-03-08 13:13:21 +0100 with Markdown engine kramdown (1.9.0)
                  using options {}
  -->

<!-- _S9SLIDE_ -->
<h1 id="agenda">Agenda</h1>

<ul>
  <li>What&#8217;s Metalsmith?</li>
  <li>Everything is a Plugin</li>
  <li>File / Directory Structure</li>
  <li>HTML Templates - Handlebars or Nunjucks?</li>
  <li>Pages n Posts with Front Matter</li>
  <li>Datafiles</li>
  <li>HTML Templates - Loops</li>
  <li>All Together Now - build.js</li>
  <li>Real World Showcase -  Node.js Project Site</li>
  <li>More Plugins</li>
  <li>Write Your Own Plugins</li>
  <li>Links, Links, Links</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="whats-metalsmith">What&#8217;s Metalsmith?</h1>

<p>A static site builder in JavaScript (Node.js).</p>

<p><img src="i/staticgen-metalsmith.png" alt="" /></p>

<p>See <a href="http://www.metalsmith.io"><code>metalsmith.io</code></a> »</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---everything-is-a-plugin">Metalsmith - Everything is a Plugin</h1>

<p>Configure file processing build pipeline / chain using plugins</p>

<p>Example - <code>build.js</code>:</p>

<pre><code>Metalsmith(_dirname)
  .source( 'src' )

  /*******************
    add plugins here
   ******************* /
 
  .destination( 'build' )
  .build( function(err) {
	        if (err) console.log(err);
  });
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---everything-is-a-plugin-cont">Metalsmith - Everything is a Plugin (Cont.)</h1>

<p>Example:</p>

<pre><code>  .use( metadata({
          links:  './data/links.json' }))
  .use( inPlace({
          engine: 'nunjucks',
          pattern: '**/*.html' }))
  .use( markdown() )
  .use( layouts({
          engine: 'nunjucks',
          directory: './layouts' }))
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---file--directory-structure">Metalsmith - File / Directory Structure</h1>

<pre><code>├── build.js                     # Metalsmith build script / configuration
├── layouts/
|   ├── default.html             # master layout template
|   ├── page.html                # - layout for pages
|   └── post.html                # - layout for blog posts
└─── src/
    ├── css/
    |   └── style.css           
    ├── data/
    |   └── links.json           # datafile (in json)
    ├── posts/
    |    ├── 2014-11-11-new-repo-maps.md
    |    ├── 2014-12-12-new-build-system.md
    |    └── 2015-08-25-new-season.md   
    ├── about.md                 # about page (in markdown e.g. md) 
    └── index.html               # front page (in hypertext e.g. html)
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---file--directory-structure----output">Metalsmith - File / Directory Structure  - Output</h1>

<p>Use:</p>

<pre><code>$ node build.js
</code></pre>

<p>Resulting in:</p>

<pre><code>└─── build/
     ├── css/
     |   └── style.css
     ├── posts/
     |    ├── 2014-11-11-new-repo-maps.html
     |    ├── 2014-12-12-new-build-system.html
     |    └── 2015-08-25-new-season.html
     ├── about.html
     └── index.html     
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---file--directory-structure---output-cont">Metalsmith - File / Directory Structure - Output (Cont.)</h1>

<p><img src="i/staystatic-samplesite.png" alt="" /></p>

<p>(Source: Stay Static Sample Site Showcase - <code>index.html</code>)</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---html-templates---handlebars-or-nunjucks">Metalsmith - HTML Templates - Handlebars or Nunjucks?</h1>

<p><strong>Handlebars</strong> (web: <a href="http://handlebarsjs.com"><code>handlebarsjs.com</code></a>) - Minimalistic
Mustache-style <code>{{}}</code> &#8220;logic-less&#8221; templates
(e.g. no arguments for if conditionals or each loops possible,
no nested layouts, no content blocks, no inline macros, etc.)</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  {{&gt; head }}
  &lt;body&gt;
     {{&gt; header }}
    &lt;div class="main"&gt;
      {{ contents }}
    &lt;/div&gt;   
     {{&gt; footer }}
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>(Source: <a href="https://github.com/staystatic/metalsmith-handlebars/blob/master/layouts/default.html"><code>staystatic/metalsmith-handlebars/layouts/default.html</code></a>)</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---html-templates---handlebars-or-nunjucks-cont">Metalsmith - HTML Templates - Handlebars or Nunjucks? (Cont.)</h1>

<p><strong>Nunjucks</strong> (web: <a href="https://mozilla.github.io/nunjucks"><code>mozilla.github.io/nunjucks</code></a>) - Rich &amp; powerful
template language with block inheritance, autoescaping, macros, asynchronous control, and much more.
(Inspired by Jinja2 - a python template language inspired by Django&#8217;s template language).</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  {% include 'partials/head.html' %}
  &lt;body&gt;
    {% include 'partials/header.html' %}
    &lt;div class="main"&gt;
      {% block content %}
        {{ contents | safe }}
      {% endblock %}
    &lt;/div&gt;   
    {% include 'partials/footer.html' %}
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>(Source: <a href="https://github.com/staystatic/metalsmith-nunjucks/blob/master/layouts/default.html"><code>staystatic/metalsmith-nunjucks/layouts/default.html</code></a>)</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---html-templates---handlebars-or-nunjucks-cont-1">Metalsmith - HTML Templates - Handlebars or Nunjucks? (Cont.)</h1>

<p>Metalsmith uses Consolidate.js (github: <a href="https://github.com/tj/consolidate.js">tj/consolidate.js</a>) -
a template engine consolidation library for Node.js.
More template engines include:</p>

<ul>
  <li>Eco (Embedded CoffeeScript)</li>
  <li>EJS (Embedded JavaScript)</li>
  <li>Jade</li>
  <li>Liquid</li>
  <li>Mustache</li>
  <li>And many more</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---pages-n-posts-with-front-matter">Metalsmith - Pages n Posts with Front Matter</h1>

<p>YAML + Markdown</p>

<pre><code>---
layout: post
title:  beer.db - New Repo /maps - Free Interactive Beer Maps w/ Brewery Listings
---

The beer.db project - offering free public domain beer, brewery
and brewpubs data - added a new repo, that is, `/maps` 
for hosting 'full-screen' interactive beer maps with brewery listings.

See an example [beer map for Austria](http://openbeer.github.io/maps/at)
(~200 breweries n brewpubs) live or
[check the source](https://github.com/openbeer/maps) using the mapbox.js mapping library.

...
</code></pre>

<p>(Source: <a href="https://github.com/staystatic/metalsmith-nunjucks/blob/master/src/posts/new-repo-maps.md"><code>staystatic/metalsmith-nunjucks/src/posts/new-repo-maps.md</code></a>)</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---datafiles">Metalsmith - Datafiles</h1>

<p>Links &#8216;n&#8217; Bookmarks in JSON</p>

<pre><code>[
 { "title": "football.db - Open Football Data",
   "url":   "https://github.com/openfootball" },
 { "title": "beer.db - Open Beer, Brewery 'n' Brewpub Data",
   "url":   "https://github.com/openbeer" },
 { "title": "world.db - Open World Data",
   "url":   "https://github.com/openmundi" }
]
</code></pre>

<p>(Source: <a href="https://github.com/staystatic/metalsmith-nunjucks/blob/master/src/data/links.json"><code>staystatic/metalsmith-nunjucks/src/data/links.json</code></a>)</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---html-templates---loops---handlebars-or-nunjucks">Metalsmith - HTML Templates - Loops - Handlebars or Nunjucks?</h1>

<p><strong>Handlebars</strong></p>

<pre><code>&lt;div&gt;
  &lt;b&gt;Links 'n' Bookmarks&lt;/b&gt;
    &lt;ul&gt;
        {{#each links}}
          &lt;li&gt;&lt;a href="{{ url }}"&gt;{{ title }}&lt;/a&gt;&lt;/li&gt;
        {{/each}}
    &lt;/ul&gt;
&lt;/div&gt;  
</code></pre>

<pre><code>&lt;div&gt;
  &lt;b&gt;News 'n' Updates&lt;/b&gt;
    &lt;ul&gt;
        {{#each posts}}
           &lt;li&gt;&lt;a href="{{ urlxx }}"&gt;{{ title }}&lt;/a&gt;&lt;/li&gt;
        {{/each}}
    &lt;/ul&gt;
&lt;/div&gt;
</code></pre>

<p>(Source: <a href="https://github.com/staystatic/metalsmith-handlebars/blob/master/src/index.html"><code>staystatic/metalsmith-handlebars/src/index.html</code></a>)</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---html-templates---loops---handlebars-or-nunjucks-cont">Metalsmith - HTML Templates - Loops - Handlebars or Nunjucks? (Cont.)</h1>

<p><strong>Nunjucks</strong></p>

<pre><code>&lt;div&gt;
  &lt;b&gt;Links 'n' Bookmarks&lt;/b&gt;
    &lt;ul&gt;
        {% for link in links %}
          &lt;li&gt;&lt;a href="{{ link.url }}"&gt;{{ link.title }}&lt;/a&gt;&lt;/li&gt;
        {% endfor %}
    &lt;/ul&gt;
&lt;/div&gt;  
</code></pre>

<pre><code>&lt;div&gt;
  &lt;b&gt;News 'n' Updates&lt;/b&gt;
    &lt;ul&gt;
        {% for post in posts %}
           &lt;li&gt;&lt;a href="{{ post.urlxx }}"&gt;{{ post.title }}&lt;/a&gt;&lt;/li&gt;
        {% endfor %}
    &lt;/ul&gt;
&lt;/div&gt;
</code></pre>

<p>(Source: <a href="https://github.com/staystatic/metalsmith-nunjucks/blob/master/src/index.html"><code>staystatic/metalsmith-nunjucks/src/index.html</code></a>)</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---all-together-now---buildjs">Metalsmith - All Together Now - build.js</h1>

<pre><code>var Metalsmith  = require('metalsmith');
var markdown    = require('metalsmith-markdown');
var layouts     = require('metalsmith-layouts');
var inplace     = require('metalsmith-in-place');
var metadata    = require('metalsmith-metadata');
var collections = require('metalsmith-collections');
var permalinks  = require('metalsmith-permalinks');
var nunjucks    = require('nunjucks');


// Note: Need to add configuration to nunjucks that metalsmith cannot
nunjucks
  .configure( 'layouts', {watch: false, noCache: true}); 


metalsmith = Metalsmith(__dirname)
  .use(metadata({
    site:  { title:     "Metalsmith (+Nunjucks) Stay Static Site Sample",
             base_url": "http://staystatic.github.io/sites/metalsmith-nunjucks/" },
    links: 'data/links.json'
  }))
  .use(collections({
      posts: {
        pattern: 'posts/**/*.md',
        sortBy: 'date',
        reverse: true
      }}))
  .use(markdown())
  .use(inplace({
    engine: 'nunjucks',
    pattern: '**/*.html'
  }))
  .use(layouts({
    engine: 'nunjucks',
    pattern: '**/*.html',
    directory: 'layouts'
  }))
  .build(function(err){
    if (err) throw err;
  });
</code></pre>

<p>(Source: <a href="https://github.com/staystatic/metalsmith-nunjucks/blob/master/build.js"><code>staystatic/metalsmith-nunjucks/build.js</code></a>)</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="real-world-showcase----nodejs-project-site">Real World Showcase -  Node.js Project Site</h1>

<p><img src="i/showcase-nodejs.png" alt="" /></p>

<p>See <a href="https://nodejs.org"><code>nodejs.org</code></a>
<a href="https://github.com/nodejs/nodejs.org">(Source)</a> »</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="real-world-showcase----nodejs-project-site-cont">Real World Showcase -  Node.js Project Site (Cont.)</h1>

<p>Source - <a href="https://github.com/nodejs/nodejs.org/blob/master/build.js"><code>build.js</code></a>:</p>

<pre><code>const Metalsmith  = require('metalsmith')
const collections = require('metalsmith-collections')
const feed        = require('metalsmith-feed')
const layouts     = require('metalsmith-layouts')
const markdown    = require('metalsmith-markdown')
const prism       = require('metalsmith-prism')
const stylus      = require('metalsmith-stylus')
const permalinks  = require('metalsmith-permalinks')
const pagination  = require('metalsmith-yearly-pagination')

...

const metalsmith = Metalsmith(__dirname)
  metalsmith
    // Sets global metadata imported from the locale's respective site.json.
    .metadata({
      site: require(siteJSON),
      project: source.project,
      i18n: i18nJSON(locale)
    })
    // Sets the build source as the locale folder.
    .source(path.join(__dirname, 'locale', locale))
    // Defines the blog post/guide collections used to internally group them for
    // easier future handling and feed generation.
    .use(collections({
      blog: {
        pattern: 'blog/**/*.md',
        sortBy: 'date',
        reverse: true,
        refer: false
      },
      blogAnnounce: {
        pattern: 'blog/announcements/*.md',
        sortBy: 'date',
        reverse: true,
        refer: false
      },
      blogReleases: {
        pattern: 'blog/release/*.md',
        sortBy: 'date',
        reverse: true,
        refer: false
      },
      blogVulnerability: {
        pattern: 'blog/vulnerability/*.md',
        sortBy: 'date',
        reverse: true,
        refer: false
      },
      lastWeekly: {
        pattern: 'blog/weekly-updates/*.md',
        sortBy: 'date',
        reverse: true,
        refer: false,
        limit: 1
      },
      tscMinutes: {
        pattern: 'foundation/tsc/minutes/*.md',
        sortBy: 'date',
        reverse: true,
        refer: false
      },
      knowledgeBase: {
        pattern: 'knowledge/**/*.md',
        refer: false
      },
      guides: {
        pattern: 'docs/guides/!(index).md',
        refer: false
      }
    }))
    .use(pagination({
      path: 'blog/year',
      iteratee: (post, idx) =&gt; ({
        post,
        displaySummary: idx &lt; 10
      })
    }))
    .use(markdown(markedOptions))
    .use(githubLinks({ locale: locale }))
    .use(prism())
    // Deletes Stylus partials since they'll be included in the main CSS file
    // anyways.
    .use(filterStylusPartials())
    .use(stylus({
      compress: true,
      paths: [path.join(__dirname, 'layouts', 'css')],
      use: [autoprefixer()]
    }))
    // Set pretty permalinks, we don't want .html suffixes everywhere.
    .use(permalinks({
      relative: false
    }))
    // Generates the feed XML files from their respective collections which were
    // defined earlier on.
    .use(feed({
      collection: 'blog',
      destination: 'feed/blog.xml',
      title: 'Node.js Blog'
    }))
    .use(feed({
      collection: 'blogAnnounce',
      destination: 'feed/announce.xml',
      title: 'Node.js Announcements'
    }))
    .use(feed({
      collection: 'blogReleases',
      destination: 'feed/releases.xml',
      title: 'Node.js Blog: Releases'
    }))
    .use(feed({
      collection: 'blogVulnerability',
      destination: 'feed/vulnerability.xml',
      title: 'Node.js Blog: Vulnerability Reports'
    }))
    .use(feed({
      collection: 'tscMinutes',
      destination: 'feed/tsc-minutes.xml',
      title: 'Node.js Technical Steering Committee meetings'
    }))
    // Finally, this compiles the rest of the layouts present in ./layouts.
    // They're language-agnostic, but have to be regenerated for every locale
    // anyways.
    .use(layouts({
      engine: 'handlebars',
      pattern: '**/*.html',
      partials: 'layouts/partials',
      helpers: {
        copyright: require('./scripts/helpers/copyright-year.js'),
        equals: require('./scripts/helpers/equals.js'),
        startswith: require('./scripts/helpers/startswith.js'),
        i18n: require('./scripts/helpers/i18n.js'),
        changeloglink: require('./scripts/helpers/changeloglink.js'),
        strftime: require('./scripts/helpers/strftime.js'),
        apidocslink: require('./scripts/helpers/apidocslink.js'),
        majorapidocslink: require('./scripts/helpers/majorapidocslink.js'),
        summary: require('./scripts/helpers/summary.js')
      }
    }))
    // Pipes the generated files into their respective subdirectory in the build
    // directory.
    .destination(path.join(__dirname, 'build', locale))

  // This actually executes the build and stops the internal timer after
  // completion.
  metalsmith.build(function (err) {
    if (err) { throw err }
    console.timeEnd('[metalsmith] build/' + locale + ' finished')
  })
}
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---more-plugins">Metalsmith - More Plugins</h1>

<p><strong>metadata</strong> - Load metadata from JSON or YAML files.</p>

<p><strong>inPlace</strong> - In-place templating, render templates in your source files.</p>

<p><strong>markdown</strong> - Convert Markdown files to HTML.</p>

<p><strong>layouts</strong> - Apply layouts to your source files.</p>

<hr />

<p><strong>drafts</strong> - Hide any files marked as drafts.</p>

<p><strong>permalinks</strong>  - Apply custom permalinks and rename files to be nested properly for
static sites, basically converting about.html into about/index.html.</p>

<p><strong>collections</strong> - Group files together, like blog posts.
That way you can loop over them to generate an index, or add &#8216;next&#8217; and &#8216;previous&#8217;
links between them.</p>

<p><strong>feed</strong> - Generate an RSS feed for a collection.</p>

<p><strong>excerpts</strong> - Extract the first paragraph from the beginning of any HTML file.</p>

<p>And Many More</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---write-your-own-plugins">Metalsmith - Write Your Own Plugins</h1>

<p><strong>Inline Plugin</strong></p>

<pre><code>.use( function(files, metalsmith, done) {
    console.log(files);
    console.log(metalsmith);
    done();
})
</code></pre>

<p>Will dump all files (w/ meta data and content block)
and the metalsmith hash (w/ options, site data, collections, etc.)
to the console. Great help for understanding how metalsmith works and for
debugging - when it doesn&#8217;t work ;-).</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="metalsmith---write-your-own-plugins-1">Metalsmith - Write Your Own Plugins</h1>

<p><strong>&#8220;Standard&#8221; Plugin</strong></p>

<pre><code>var parseDate = function (files, metalsmith, done) {
  var moment = require("moment");
  for(var file in files) {
	if(files[file].date) {
	  var date = new Date(files[file].date);
	  files[file].year = moment(date).format("YYYY");
	  files[file].month = moment(date).format("MM");
	  files[file].day = moment(date).format("DD");
	}
  }
  done();
};
</code></pre>

<p>Usage:</p>

<pre><code>.use(parseDate)
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="links-links-links---static-site-news-events-n-more">Links, Links, Links - Static Site News, Events &#8216;n&#8217; More</h1>

<p><strong>Stay Static Sample Sites (Showcase)</strong></p>

<ul>
  <li><a href="http://staystatic.github.io">Stay Static</a>
    <ul>
      <li><a href="https://github.com/staystatic/metalsmith-handlebars"><code>/metalsmith-handlebars</code></a></li>
      <li><a href="https://github.com/staystatic/metalsmith-nunjucks"><code>/metalsmith-nunjucks</code></a></li>
    </ul>
  </li>
</ul>

<p><strong>Metalsmith Articles</strong></p>

<ul>
  <li><a href="https://github.com/metalsmith/awesome-metalsmith">Awesome Metalsmith</a> - articles, tutorials, sample sites and more about Metalsmith</li>
</ul>

<p><strong>News</strong></p>

<ul>
  <li><a href="https://twitter.com/statictimes">Static Times News @ Twitter</a></li>
  <li><a href="http://www.thenewdynamic.org">{static is} The New Dynamic</a>
    <ul>
      <li><a href="http://www.thenewdynamic.org/tool/metalsmith">Metalsmith</a></li>
    </ul>
  </li>
</ul>

<p><strong>Events</strong></p>

<ul>
  <li><a href="http://viennahtml.github.io">Vienna.html Meetup</a> - Next Meetup April 2016 @ sektor5 - Vienna, Austria</li>
  <li><a href="http://www.staticwebtech.com">Static Web Tech Meetup</a> - @ San Francisco, California</li>
  <li><a href="http://www.meetup.com/The-New-Dynamic">{static is} The New Dynamic Meetup</a> - @ New York City, New York</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="bonus-many-more-static-site-builder--generators">Bonus: Many More Static Site Builder / Generators</h1>

<p><strong>Q</strong>: What about Ruby, Python, PHP, Hugo, Haskell, Rust, C, Swift, Lisp, Bash, <em>[Your Language Here]</em>, etc.?</p>

<p><strong>A</strong>: See the Static Site Builder / Generator Directories:</p>

<ul>
  <li><a href="http://www.staticgen.com"><code>staticgen.com</code></a></li>
  <li><a href="https://staticsitegenerators.net"><code>staticsitegenerators.net</code></a></li>
  <li><a href="https://www.static-revival.com/static-site-generators/">Static Site Generators @ <code>static-revival.com</code></a></li>
</ul>

<!-- === end markdown block === -->
</div>


  </div> <!-- presentation -->
</body>
</html> 

