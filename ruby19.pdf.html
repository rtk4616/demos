<!DOCTYPE html>
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Ruby 1.9: What to Expect</title>
   
   

<style>
html, body { margin: 0; padding: 0; }

body { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; }

a:link, a:visited { color: black; }

h1 { font-size: 30pt;  }
h2 { font-size: 28pt;  }
h3 { font-size: 25pt;  }
p, li, dt, dd, td, th { font-size: 18pt; }

pre { font-size: 14pt;  }
pre.small { font-size: 11pt; }

pre.code {
        background-color: azure;
        padding: 5px;
      }
     
ul { list-style-type: square; }    
   
.center { text-align: center; }   
     
.slide { page-break-after: always;
         min-height: 100mm;
         padding: 40px;
         
         border: 1px dotted black;

/*      
  background: -moz-linear-gradient( top, maroon, red);
*/
       }



/*
for princexml (CSS3 paged media support)
@page { size: A4 landscape }
*/
</style>

</head>
<body>

<div class="presentation">

<div class='slide '>

<!-- _S9SLIDE_ -->
<h1>Ruby 1.9: What to Expect</h1>
<p class="center">Sam Ruby @ OSCON 2008, Portland, Oregon, July 2008<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup></p>
<p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> Adapted S6 Version from <a href="http://intertwingly.net/slides/2008/oscon/ruby19/1">Original Slide Deck</a></p>
<!-- begin help -->
<div class='help projection'>
<p><strong>Slide Show Keyboard Controls (Help)</strong></p>
<table>
	<tr>
		<td> Action </td>
		<td> Key </td>
	</tr>
	<tr>
		<td> Go to next slide </td>
		<td> Space Bar, Right Arrow, Down Arrow, Page Down, Click Heading </td>
	</tr>
	<tr>
		<td> Go to previous slide </td>
		<td> Left Arrow, Up Arrow, Page Up </td>
	</tr>
	<tr>
		<td> Toggle between slideshow and outline view (&#216;) </td>
		<td> T </td>
	</tr>
	<tr>
		<td> Show/hide slide controls (&#216; &laquo; &raquo;) </td>
		<td> C, Move mouse to bottom right corner </td>
	</tr>
	<tr>
		<td> Zoom in, zoom out, zoom reset (100%)  </td>
		<td> Control<code>+</code>Plus, Control<code>+</code>Minus, Control<code>+</code><code>0</code> </td>
	</tr>
</table>
</div>
<!-- end help -->


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>About Sam Ruby</h1>
<ul>
	<li>Agile Web Development with Rails (3rd Edition)</li>
	<li>Apache Software Foundation</li>
	<li>Atom / Feed Validator</li>
	<li>ECMA .NET CLI (No longer active)</li>
	<li>PHP Group (No longer active)</li>
	<li>RESTful Web Services</li>
</ul>
<p>- <a href="http://intertwingly.net">intertwingly.net</a></p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Agenda</h1>
<ul>
	<li>Part 0: Overview</li>
	<li>Part 1: What&#8217;s Changed?</li>
	<li>Part 2: What&#8217;s New?</li>
</ul>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 class="fullscreen">Part 0 &#8211; Overview</h1>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>What is Ruby?</h1>
<ul>
	<li>MRI (Matz&#8217; Ruby Interpreter)</li>
	<li>Rubinius &#8211; RubySpec</li>
	<li>JRuby</li>
	<li>IronRuby</li>
	<li>Ruby.NET</li>
	<li>MacRuby</li>
	<li>MagLev</li>
	<li>YARV (Yet Another Ruby Virtual-machine)</li>
</ul>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Ruby 1.9 &#8211; Major Features</h1>
<ul>
	<li>Performance</li>
	<li>Threads/Fibers</li>
	<li>Encoding/Unicode</li>
	<li>gems is (mostly) built-in now
	<ul>
		<li>No contribs</li>
	</ul></li>
</ul>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>One Lesson</h1>
<p>If you can only take away one message from this presentation:</p>
<ul>
	<li><code>if</code> statements do not introduce scope in Ruby.</li>
</ul>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Replace Methods</h1>
<p>Bilingual Ruby</p>
<pre class='code'>
class Employee
  if String.method_defined?(:encode)
    def name
      ...
    end
  else
    def name
      ...
    end
  end
end
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Replace Implementation</h1>
<p>Bilingual Ruby</p>
<pre class='code'>
if String.method_defined?(:encode)
  module Builder
    ...
  end
else
  class String
    ...
  end
end
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Continuous Integration (CI) Efforts</h1>
<ul>
	<li>Ruby</li>
	<li>Bacon</li>
	<li>Builder</li>
	<li>html5lib</li>
	<li>libxml2</li>
	<li>OpenID</li>
	<li>REXML</li>
	<li>Rake (contrib)</li>
	<li>XMPP4R</li>
</ul>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 class="fullscreen">Part 1 &#8211; What&#8217;s Changed?</h1>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Single Character Strings</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; ?c
=&gt; "c"
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; ?c
=&gt; 99
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>String Index</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; "cat"[1]
=&gt; "a"
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; "cat"[1]
=&gt; 97
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>{&quot;a&quot;,&quot;b&quot;} No Longer Supported</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):002:0&gt; {1,2}
SyntaxError: (irb):2: syntax error, unexpected ',', expecting tASSOC
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; {1,2}
=&gt; {1=&gt;2}
</pre>
<p><strong>Action</strong>: Convert to <code>{1 =&gt; 2}</code></p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1><code>Array.to_s</code> Now Contains Punctuation</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; [1,2,3].to_s
=&gt; "[1, 2, 3]"
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; [1,2,3].to_s
=&gt; "123"
</pre>
<p><strong>Action</strong>: Use <code>.join</code> instead</p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Colon No Longer Valid In When Statements</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; case 'a'; when /\w/: puts 'word'; end
SyntaxError: (irb):1: syntax error, unexpected ':',
expecting keyword_then or ',' or ';' or '\n'
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; case 'a'; when /\w/: puts 'word'; end
word
</pre>
<p><strong>Action</strong>: Use semicolon, <code>then</code>, or newline</p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Block Variables Now Shadow Local Variables</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; i=0; [1,2,3].each {|i|}; i
=&gt; 0
irb(main):002:0&gt; i=0; for i in [1,2,3]; end; i
=&gt; 3
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; i=0; [1,2,3].each {|i|}; i
=&gt; 3
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1><code>Hash.index</code> Deprecated</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; {1=&gt;2}.index(2)
(irb):18: warning: Hash#index is deprecated; use Hash#key
=&gt; 1
irb(main):002:0&gt; {1=&gt;2}.key(2)
=&gt; 1
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; {1=&gt;2}.index(2)
=&gt; 1
</pre>
<p><strong>Action</strong>: Use <code>Hash.key</code></p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1><code>Fixnum.to_sym</code> Now Gone</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; 5.to_sym
NoMethodError: undefined method 'to_sym' for 5:Fixnum
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; 5.to_sym
=&gt; nil
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1><code>Fixnum.to_sym</code> Now Gone (Cont&#8217;d)</h1>
<p>Ruby 1.9</p>
<pre class='code'>
# Find an argument value by name or index.
def [](index)
  lookup(index.to_sym)
end
</pre>
<p><a href="http://svn.ruby-lang.org/repos/ruby/trunk/lib/rake.rb"><code>svn.ruby-lang.org/repos/ruby/trunk/lib/rake.rb</code></a></p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Hash Keys Now Unordered</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; {:a=&gt;"a", :c=&gt;"c", :b=&gt;"b"}
=&gt; {:a=&gt;"a", :c=&gt;"c", :b=&gt;"b"}
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; {:a=&gt;"a", :c=&gt;"c", :b=&gt;"b"}
=&gt; {:a=&gt;"a", :b=&gt;"b", :c=&gt;"c"}
</pre>
<p>Order is insertion order</p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Stricter Unicode Regular Expressions</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; /\x80/u
SyntaxError: (irb):2: invalid multibyte escape: /\x80/
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; /\x80/u
=&gt; /\x80/u
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1><code>tr</code> and <code>Regexp</code> Now Understand Unicode</h1>
<p>Ruby 1.9</p>
<pre class='code'>
unicode(string).tr(CP1252_DIFFERENCES, UNICODE_EQUIVALENT).
  gsub(INVALID_XML_CHAR, REPLACEMENT_CHAR).
  gsub(XML_PREDEFINED) {|c| PREDEFINED[c.ord]}
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1><code>pack</code> and <code>unpack</code></h1>
<p>Ruby 1.8.6</p>
<pre class='code'>
def xchr(escape=true)
  n = XChar::CP1252[self] || self
  case n when *XChar::VALID
    XChar::PREDEFINED[n] or 
      (n&gt;128 ? n.chr : (escape ? "&amp;##{n};" : [n].pack('U*')))
  else
    Builder::XChar::REPLACEMENT_CHAR
  end
end
unpack('U*').map {|n| n.xchr(escape)}.join
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1><code>BasicObject</code> More Brutal Than <code>BlankSlate</code></h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; class C &lt; BasicObject; def f; Math::PI; end; end; C.new.f
NameError: uninitialized constant C::Math
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; require 'blankslate'
=&gt; true
irb(main):002:0&gt; class C &lt; BlankSlate; def f; Math::PI; end; end; C.new.f
=&gt; 3.14159265358979
</pre>
<p><strong>Action</strong>: Use <code>::Math::PI</code></p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Delegation Changes</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):002:0&gt; class C &lt; SimpleDelegator; end
=&gt; nil
irb(main):003:0&gt; C.new('').class
=&gt; String
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):002:0&gt; class C &lt; SimpleDelegator; end
=&gt; nil
irb(main):003:0&gt; C.new('').class
=&gt; C
irb(main):004:0&gt;
</pre>
<p><a href="http://rubyforge.org/tracker/index.php?func=detail&amp;aid=17700&amp;group_id=426&amp;atid=1698">Defect 17700</a></p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Use of $KCODE Produces Warnings</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):004:1&gt; $KCODE = 'UTF8'
(irb):4: warning: variable $KCODE is no longer effective; ignored
=&gt; "UTF8"
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; $KCODE = 'UTF8'
=&gt; "UTF8"
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1><code>instance_methods</code> Now an Array of Symbols</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; {}.methods.sort.last
=&gt; :zip
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
irb(main):001:0&gt; {}.methods.sort.last
=&gt; "zip"
</pre>
<p><strong>Action</strong>: Replace <code>instance_methods.include?</code> with <code>method_defined?</code></p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Source File Encoding</h1>
<p>Basic</p>
<pre class='code'>
# coding: utf-8
</pre>
<p>Emacs</p>
<pre class='code'>
# -*- encoding: utf-8 -*-
</pre>
<p>Shebang</p>
<pre class='code'>
#!/usr/local/rubybook/bin/ruby
# encoding: utf-8
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Real Threading</h1>
<ul>
	<li>Race Conditions</li>
	<li>Implicit Ordering Assumptions</li>
	<li>Test Code</li>
</ul>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Implications</h1>
<ul>
	<li>Changes are straightforward</li>
	<li>Cumulative effect is massive</li>
	<li>The biggest obstacle to Ruby 1.9&#8217;s adoption is the sheer number of mostly working but essentially unmaintained gems that virtually everybody in the Ruby community depends on</li>
	<li>Emergence of alternate implementations also a source for inertia</li>
</ul>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Recommendations</h1>
<p>Encourage maintainers of gems to:</p>
<ul>
	<li>Produce versions of gems that work with 1.8.x and 1.9</li>
	<li>For long term, move to distributed version control systems (DVCS) like <code>git</code></li>
</ul>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Rails Dependencies</h1>
<p><code>actionmailer-2.1.0</code>, <code>actionpack-2.1.0</code>, <code>activerecord-2.1.0</code>, <code>activeresource-2.1.0</code>, <code>activesupport-2.1.0</code>, <code>builder-2.1.2</code>, <code>memcache-client-1.5.0</code>, <code>rails-2.1.0</code>, <code>rake-0.8.1</code>, <code>sources-0.0.1</code>, <code>text-format-0.6.3</code>, <code>tmail-1.2.3</code>, <code>tzinfo-0.3.8</code>, <code>xml-simple-1.0.11</code>, <code>html-scanner</code>, <code>db2.rb</code>, <code>mysql.rb</code></p>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 class="fullscreen">Part 2 &#8211; What&#8217;s New?</h1>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Alternate Syntax for Symbol as Hash Keys</h1>
<p>Ruby 1.9</p>
<pre class='code'>
{a: b}

redirect_to action: show
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
{:a =&gt; b}

redirect_to :action =&gt; show
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Block Local Variables</h1>
<p>Ruby 1.9</p>
<pre class='code'>
[1,2].each {|value; t| t=value*value}
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Inject Methods</h1>
<p>Ruby 1.9</p>
<pre class='code'>
[1,2].inject(:+)
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
[1,2].inject {|a,b| a+b}
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1><code>to_enum</code></h1>
<p>Ruby 1.9</p>
<pre class='code'>
short_enum = [1, 2, 3].to_enum
long_enum = ('a'..'z').to_enum
loop do
  puts "#{short_enum.next} #{long_enum.next}"
end
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>No block? Enum!</h1>
<p>Ruby 1.9</p>
<pre class='code'>
e = [1,2,3].each
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Lambda Shorthand</h1>
<p>Ruby 1.9</p>
<pre class='code'>
p = -&gt; a,b,c {a+b+c}
puts p.(1,2,3)
puts p[1,2,3]
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
p = lambda {|a,b,c| a+b+c}
puts p.call(1,2,3)
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Complex Numbers</h1>
<p>Ruby 1.9</p>
<pre class='code'>
Complex(3,4) == 3 + 4.im
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Decimal Is Still Not The Default</h1>
<p>Ruby 1.9</p>
<pre class='code'>
irb(main):001:0&gt; 1.2-1.1
=&gt; 0.0999999999999999
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Regex &#8220;Properties&#8221;</h1>
<p>Ruby 1.9</p>
<pre class='code'>
/\p{Space}/
</pre>
<p>Ruby 1.8.6</p>
<pre class='code'>
/[:space:]/
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Splat in Middle</h1>
<p>Ruby 1.9</p>
<pre class='code'>
def foo(first, *middle, last)

(-&gt;a, *b, c {p a-c}).(*5.downto(1))
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Fibers</h1>
<p>Ruby 1.9</p>
<pre class='code'>
f = Fiber.new do
  a,b = 0,1
  Fiber.yield a
  Fiber.yield b
  loop do
    a,b = b,a+b
    Fiber.yield b
  end
end
10.times {puts f.resume}
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Break Values</h1>
<p>Ruby 1.9</p>
<pre class='code'>
match =
   while line = gets
     next if line =~ /^#/
     break line if line.find('ruby')
   end
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>&#8220;Nested&#8221; Methods</h1>
<p>Ruby 1.9</p>
<pre class='code'>
def toggle
  def toggle
    "subsequent times"
  end
  "first time"
end
</pre>

</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1>Questions</h1>
<ul>
	<li>Any questions?</li>
	<li><a href="http://www.pragprog.com/titles/ruby3/programming-ruby-3">Programming Ruby 3</a></li>
	<li>Thanks for coming!</li>
</ul>
<!-- begin google-analytics {:code=>"UA-397343-10"} -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-397343-10']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- end google-analytics -->
</div>


  </div> <!-- presentation -->
</body>
</html> 

