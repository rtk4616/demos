<!DOCTYPE html>
<html>
<head>
   <meta http-equiv="content-type" content="text/html;charset=utf-8"> 
   <title>Almost Sinatra in Six Lines of Ruby - A Breakdown</title>

<meta name="generator" content="Slide Show (S9) v2.5.0 on Ruby 2.1.5 (2014-11-13) [i386-mingw32]">
<meta name="author"    content="Your Name Here" >

<!-- helper/macro that lets you add (CSS3) gradient using headers
     see http://slideshow.rubyforge.org/themes.html
     
     -->

<!-- S6 style sheet links -->
<link rel="stylesheet" href="almost_sinatra.css" media="projection" id="styleProjection">
<link rel="stylesheet" href="s6/screen.css"         media="screen"     id="styleScreen">
<link rel="stylesheet" href="s6/print.css"          media="print">

<!-- S6 JS -->
<script src="s6/jquery.js"></script>
<script src="s6/jquery.slideshow.js"></script>
<script>
  $(document).ready( function() {
    Slideshow.init();
  } );

  
</script>

<!-- Better Browser Banner for Microsoft Internet Explorer (IE) -->
<!--[if IE]>
<script src="s6/jquery.microsoft.js"></script>
<![endif]-->



</head>
<body>

<div class="layout"> 
  <div id="header"></div>
  <div id="footer">
    <h1>Your Footer Here</h1>
    <h2>Your Subfooter Here</h2>
  </div>
</div>

<div class="presentation">
   
<div class='slide '>
<!-- === begin markdown block ===

      generated by markdown/1.2.0 on Ruby 2.1.5 (2014-11-13) [i386-mingw32]
                on 2015-05-07 16:36:14 +0200 with Markdown engine kramdown (1.5.0)
                  using options {}
  -->


<!-- _S9SLIDE_ -->
<h1 id="agenda">Agenda</h1>

<p>Almost Sinatra in Six Lines of Ruby - A Breakdown</p>

<ul>
  <li>What&#8217;s Sinatra?</li>
  <li>What&#8217;s Almost Sinatra?</li>
  <li>Why? Why? Why?</li>
  <li>Almost Sinatra - A Breakdown - Line 1/6</li>
  <li>What&#8217;s Rack?</li>
  <li>What&#8217;s Tilt?</li>
  <li>Almost Sinatra - A Breakdown - Line 2/6</li>
  <li>Almost Sinatra - A Breakdown - Line 3/6</li>
  <li>Almost Sinatra - A Breakdown - Line 4/6</li>
  <li>Almost Sinatra - A Breakdown - Line 5/6</li>
  <li>Almost Sinatra - A Breakdown - Line 6/6</li>
  <li>The Proof of the Pudding  - example.rb</li>
  <li>Got Inspired? Build Your Own Microframework</li>
  <li>Thanks - Links, Links, Links</li>
  <li>Real World Case Study - webservice gem - (Yet Another) HTTP JSON API (Web Service) Builder </li>
  <li>Bonus: Fun Almost Sinatra Obfuscation Hacks</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="awesome-viennarb---awesome-awesomeness">Awesome Vienna.rb - Awesome Awesomeness</h1>

<blockquote>
  <p>aweseome /ˈɔːsəm/ - adjective  -
  inspiring, excellent, outstanding, wonderful, cool, terrific, extraordinary</p>
</blockquote>

<h3 id="whats-awesome-x">What&#8217;s Awesome <x>?</x></h3>

<p>A collection of awesome links. A single README page on GitHub.
Contributions welcome. Send in a pull request etc.</p>

<ul>
  <li>
    <p>Awesome Ruby</p>
  </li>
  <li><a href="https://github.com/planetruby/awesome-events">Awesome Events @ Planet Ruby</a></li>
  <li><a href="https://github.com/planetruby/awesome-rubies">Awesome Rubies @ Planet Ruby</a></li>
  <li>
    <p><a href="https://github.com/planetruby/awesome-activerecord">Awesome ActiveRecord @ Planet Ruby</a></p>
  </li>
  <li><a href="https://github.com/writekit/awesome-markdown">Awesome Markdown</a></li>
  <li>
    <p><a href="https://github.com/writekit/awesome-books">Awesome Books</a></p>
  </li>
  <li><a href="https://github.com/planetopendata/awesome-sqlite">Awesome SQLite @ Planet Open Data</a></li>
  <li><a href="https://github.com/planetopendata/awesome-world">Awesome World @ Planet Open Data</a></li>
  <li><a href="https://github.com/planetopendata/awesome-football">Awesome Football @ Planet Open Data</a></li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="whats-sinatra">What&#8217;s Sinatra?</h1>

<p>Simple (yet powerful and flexible) micro webframework.</p>

<pre><code>require 'sinatra'

get '/' do
  'Hallo Vienna! Servus Wien!'
end
</code></pre>

<p>Trivia Quiz - How Many Lines of Ruby Code?</p>

<p>(A) 20 Lines
(B) 200 Lines
(C) 2 000 Lines
(D) 20 000 Lines</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="whats-almost-sinatra">What&#8217;s Almost Sinatra?</h1>

<p>Sinatra refactored, only six lines now. A hack by Konstantin Haase.</p>

<p><a href="https://github.com/rkh/almost-sinatra/blob/master/almost_sinatra.rb">almost_sinatra.rb</a>:</p>

<pre><code>%w.rack tilt date INT TERM..map{|l|trap(l){$r.stop}rescue require l};$u=Date;$z=($u.new.year + 145).abs;puts "== Almost Sinatra/No Version has taken the stage on #$z for development with backup from Webrick"
$n=Module.new{extend Rack;a,D,S,q=Rack::Builder.new,Object.method(:define_method),/@@ *([^\n]+)\n(((?!@@)[^\n]*\n)*)/m
%w[get post put delete].map{|m|D.(m){|u,&amp;b|a.map(u){run-&gt;(e){[200,{"Content-Type"=&gt;"text/html"},[a.instance_eval(&amp;b)]]}}}}
Tilt.mappings.map{|k,v|D.(k){|n,*o|$t||=(h=$u._jisx0301("hash, please");File.read(caller[0][/^[^:]+/]).scan(S){|a,b|h[a]=b};h);v[0].new(*o){n=="#{n}"?n:$t[n.to_s]}.render(a,o[0].try(:[],:locals)||{})}}
%w[set enable disable configure helpers use register].map{|m|D.(m){|*_,&amp;b|b.try :[]}};END{Rack::Handler.get("webrick").run(a,Port:$z){|s|$r=s}}
%w[params session].map{|m|D.(m){q.send m}};a.use Rack::Session::Cookie;a.use Rack::Lock;D.(:before){|&amp;b|a.use Rack::Config,&amp;b};before{|e|q=Rack::Request.new e;q.params.dup.map{|k,v|params[k.to_sym]=v}}}
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="why-why-why">Why? Why? Why?</h1>

<blockquote>
  <p>Until programmers stop acting like obfuscation is morally hazardous,
they&#8217;re not artists, just kids who don’t want their food to touch.
 &#8211; _why</p>
</blockquote>

<pre><code>$ sloccount alomst_sinatra.rb
Total Physical Source Lines of Code (SLOC)                = 8
Development Effort Estimate, Person-Years (Person-Months) = 0.00 (0.02)
 (Basic COCOMO model, Person-Months = 2.4 * (KSLOC**1.05))
Schedule Estimate, Years (Months)                         = 0.04 (0.51)
 (Basic COCOMO model, Months = 2.5 * (person-months**0.38))
Estimated Average Number of Developers (Effort/Schedule)  = 0.03
Total Estimated Cost to Develop                           = $ 170
 (average salary = $56,286/year, overhead = 2.40).
</code></pre>

<p>Performance. It&#8217;s just amazing. No code is faster than no code.</p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="almost-sinatra---a-breakdown---line-16">Almost Sinatra - A Breakdown - Line 1/6</h1>

<p>(Like) Sinatra  = Rack + Tilt</p>

<p>Line 1:</p>

<pre><code>%w.rack tilt date INT TERM..map{|l|trap(l){$r.stop}rescue require l};$u=Date;$z=($u.new.year + 145).abs;puts "== Almost Sinatra/No Version has taken the stage on #$z for development with backup from Webrick"
</code></pre>

<p>Breakdown:</p>

<pre><code>require 'rack'
require 'tilt'

trap( 'INT' )  { $server.stop }  # rename $r to $server
trap( 'TERM' ) { $server.stop }

$port = 4567              # rename $z to $port

puts "== Almost Sinatra has taken the stage on #{$port} for development with backup from Webrick"
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="whats-rack">What&#8217;s rack?</h1>

<p>Lets you mix &#8216;n&#8217; match servers and apps.</p>

<p>Lets you stack apps inside apps inside apps inside apps inside apps.</p>

<p>Good News: A Sinatra app is a Rack app.</p>

<p>Learn more about Rack @ <a href="http://rack.github.io"><code>rack.github.io</code></a>.</p>

<p><img src="i/racksite.png" alt="" /></p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="whats-tilt">What&#8217;s tilt?</h1>

<p>Tilt offers a standard &#8220;generic&#8221; interface for template engines.</p>

<p>Let&#8217;s check-up what formats and template engines tilt includes out-of-the-box:</p>

<pre><code>require 'tilt'

Tilt.mappings.each do |ext, engines|
  puts "#{ext.ljust(12)} : #{engines.inspect}"
end
</code></pre>

<p>Will result in:</p>

<pre><code>str          : [Tilt::StringTemplate]
erb          : [Tilt::ErubisTemplate, Tilt::ERBTemplate]
rhtml        : [Tilt::ErubisTemplate, Tilt::ERBTemplate]
erubis       : [Tilt::ErubisTemplate]
etn          : [Tilt::EtanniTemplate]
etanni       : [Tilt::EtanniTemplate]
haml         : [Tilt::HamlTemplate]
sass         : [Tilt::SassTemplate]
scss         : [Tilt::ScssTemplate]
less         : [Tilt::LessTemplate]
rcsv         : [Tilt::CSVTemplate]
coffee       : [Tilt::CoffeeScriptTemplate]
nokogiri     : [Tilt::NokogiriTemplate]
builder      : [Tilt::BuilderTemplate]
mab          : [Tilt::MarkabyTemplate]
liquid       : [Tilt::LiquidTemplate]
radius       : [Tilt::RadiusTemplate]
markdown     : [Tilt::RedcarpetTemplate, Tilt::RedcarpetTemplate::Redcarpet2, Tilt::RedcarpetTemplate::Redcarpet1, Tilt::RDiscountTemplate, Tilt::BlueClothTemplate, Tilt::KramdownTemplate, Tilt::MarukuTemplate]
mkd          : [Tilt::RedcarpetTemplate, Tilt::RedcarpetTemplate::Redcarpet2, Tilt::RedcarpetTemplate::Redcarpet1, Tilt::RDiscountTemplate, Tilt::BlueClothTemplate, Tilt::KramdownTemplate, Tilt::MarukuTemplate]
md           : [Tilt::RedcarpetTemplate, Tilt::RedcarpetTemplate::Redcarpet2, Tilt::RedcarpetTemplate::Redcarpet1, Tilt::RDiscountTemplate, Tilt::BlueClothTemplate, Tilt::KramdownTemplate, Tilt::MarukuTemplate]
textile      : [Tilt::RedClothTemplate]
rdoc         : [Tilt::RDocTemplate]
wiki         : [Tilt::WikiClothTemplate, Tilt::CreoleTemplate]
creole       : [Tilt::CreoleTemplate]
mediawiki    : [Tilt::WikiClothTemplate]
mw           : [Tilt::WikiClothTemplate]
yajl         : [Tilt::YajlTemplate]
ad           : [Tilt::AsciidoctorTemplate]
adoc         : [Tilt::AsciidoctorTemplate]
asciidoc     : [Tilt::AsciidoctorTemplate]
html         : [Tilt::PlainTemplate]
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="almost-sinatra---a-breakdown---line-26">Almost Sinatra - A Breakdown - Line 2/6</h1>

<p>Line 2:</p>

<pre><code>$n=Module.new{extend Rack;a,D,S,q=Rack::Builder.new,Object.method(:define_method),/@@ *([^\n]+)\n(((?!@@)[^\n]*\n)*)/m
</code></pre>

<p>Breakdown:</p>

<pre><code>$n = Module.new do
  app = Rack::Builder.new      # rename a to app
  req = nil                    # rename q to req
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="almost-sinatra---a-breakdown---line-36">Almost Sinatra - A Breakdown - Line 3/6</h1>

<p>Line 3:</p>

<pre><code>%w[get post put delete].map{|m|D.(m){|u,&amp;b|a.map(u){run-&gt;(e){[200,{"Content-Type"=&gt;"text/html"},[a.instance_eval(&amp;b)]]}}}}
</code></pre>

<p>Breakdown:</p>

<pre><code>  ['get','post','put','delete'].each do |method|
    define_method method do |path, &amp;block|
      app.map( path ) do
        run -&gt;(env){ [200, {'Content-Type'=&gt;'text/html'}, [app.instance_eval( &amp;block )]]}
      end
    end
  end
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="almost-sinatra---a-breakdown---line-46">Almost Sinatra - A Breakdown - Line 4/6</h1>

<p>Line 4:</p>

<pre><code>Tilt.mappings.map{|k,v|D.(k){|n,*o|$t||=(h=$u._jisx0301("hash, please");File.read(caller[0][/^[^:]+/]).scan(S){|a,b|h[a]=b};h);v[0].new(*o){n=="#{n}"?n:$t[n.to_s]}.render(a,o[0].try(:[],:locals)||{})}}
</code></pre>

<p>Breakdown:</p>

<pre><code>  Tilt.mappings.each do |ext, engines|          # rename k to ext and v to engines
    define_method ext do |text, *args|          # rename n to text and o to args
      template = engines[0].new(*args) do
        text
      end
      locals = (args[0].respond_to?(:[]) ? args[0][:locals] : nil) || {}    # was o[0].try(:[],:locals)||{}
      template.render( app, locals )
    end
  end
</code></pre>

<p>Commentary: Almost Sinatra will define a method for every format so you can use, for example:</p>

<pre><code>markdown "Strong emphasis, aka bold, with **asterisks** or __underscores__."
</code></pre>

<p>or</p>

<pre><code>erb "Hello &lt;%= name %&gt;!", locals: { name: params['name'] }
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="almost-sinatra---a-breakdown---line-56">Almost Sinatra - A Breakdown - Line 5/6</h1>

<p>Line 5:</p>

<pre><code>%w[set enable disable configure helpers use register].map{|m|D.(m){|*_,&amp;b|b.try :[]}};END{Rack::Handler.get("webrick").run(a,Port:$z){|s|$r=s}}
</code></pre>

<p>Breakdown:</p>

<pre><code>  # was END { ... }; change to run! method
  define_method 'run!' do
    Rack::Handler.get('webrick').run( app, Port:$port ) {|server| $server=server }
  end
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="almost-sinatra---a-breakdown---line-66">Almost Sinatra - A Breakdown - Line 6/6</h1>

<p>Line 6:</p>

<pre><code>%w[params session].map{|m|D.(m){q.send m}};a.use Rack::Session::Cookie;a.use Rack::Lock;D.(:before){|&amp;b|a.use Rack::Config,&amp;b};before{|e|q=Rack::Request.new e;q.params.dup.map{|k,v|params[k.to_sym]=v}}}
</code></pre>

<p>Breakdown:</p>

<pre><code>  ['params','session'].each do |method|
    define_method method do
      req.send method
    end
  end

  app.use Rack::Session::Cookie
  app.use Rack::Lock
  app.use Rack::Config do |env|
    req = Rack::Request.new( env )
  end
end # Module.new
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="the-proof-of-the-pudding----examplerb">The Proof of the Pudding  - example.rb</h1>

<p><code>example.rb</code>:</p>

<pre><code>require_relative 'almost_sinatra'

include $n    # include "anonymous" Almost Sinatra DSL module

get '/hello' do
  erb "Hello &lt;%= name %&gt;!", locals: { name: params['name'] }
end

get '/' do
  markdown &lt;&lt;EOS
## Welcome to Almost Sinatra 

A six line ruby hack by Konstantin Haase.

Try:
- [Say hello!](/hello?name=Nancy)

Powered by Almost Sinatra (#{Time.now})
EOS
end


run!
</code></pre>

<p>Use</p>

<pre><code>$ ruby ./example.rb
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="got-inspired-build-your-own-microframework">Got Inspired? Build Your Own Microframework</h1>

<ul>
  <li>New York, New York</li>
  <li>Nancy</li>
  <li>Rum</li>
  <li>Cuba</li>
  <li>Roda</li>
  <li>and many more</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="real-world-case-study---webservice-gem---yet-another-http-json-api-web-service-builder">Real World Case Study - webservice gem - (Yet Another) HTTP JSON API (Web Service) Builder</h1>

<p>Micro &#8220;framework&#8221; for building HTTP JSON APIs (about 100 lines of code).
Example:</p>

<pre><code>get '/beer/:key' do
  Beer.find_by_key!( params[ :key ] )
end

get '/brewery/:key' do
  Brewery.find_by_key!( params[ :key ] )
end
</code></pre>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="thanks---links-links-links">Thanks - Links, Links, Links</h1>

<ul>
  <li>Article :: <a href="https://robm.me.uk/2013/12/13/decoding-almost-sinatra.html">Decoding “Almost Sinatra</a>, by Rob Miller</li>
  <li>Article :: <a href="http://www.sitepoint.com/code-safari-almost-sinatra-almost-readable/">Code Safari: Almost Sinatra, Almost Readable</a>, by Xavier Shay</li>
  <li>Article :: <a href="http://planetruby.github.io/gems/tilt.html">tilt gem - let&#8217;s build (yet another) micro web framework in less than 33 lines of code</a>, by Gerald Bauer</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="bonus-fun-almost-sinatra-obfuscation-hacks">Bonus: Fun Almost Sinatra Obfuscation Hacks</h1>

<p>&#8220;Calculate&#8221; the Sinatra Port 4567:</p>

<pre><code>Date.new.year + 145).abs     # Date.new.year always returns -4712, the default value for years
# =&gt; 4567
</code></pre>

<p>&#8220;Get&#8221; empty Hash (e.g. <code>{}</code>):</p>

<pre><code>Date._jisx0301("hash, please")
# =&gt; {}
</code></pre>

<!-- === end markdown block === -->
</div>


</div><!-- presentation -->
</body>
</html>
